<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Sizedog by akifkhan</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Sizedog</h1>
        <h2>Automatic Resizing of LVM and File Systems in OpenSUSE</h2>
        <a href="https://github.com/akifkhan/SizeDog" class="button"><small>View project on</small>GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h3>
<a name="abstract" class="anchor" href="#abstract"><span class="octicon octicon-link"></span></a>Abstract:</h3>

<p>To build a standalone Application/tool called Size Dog that can perform Automatic resizing of File system and Logical Volumes. This Application/Tool can be called by the package manager if the size of the package to be installed exceeds the size available on the logical volume and increase the size of the logical volume if there is unallocated space in the logical volume group.</p>

<h3>
<a name="detailed-description" class="anchor" href="#detailed-description"><span class="octicon octicon-link"></span></a>Detailed Description:</h3>

<p>openSUSE currently provides good support for creating LVM volumes and installing the OS on these volumes. However, if the file system becomes full, the user/administrator has to increase the volume size and contained file system capacity manually.</p>

<p>##Goal of the project:
To implement automatic resizing of LVM volumes and contained file systems. This resizing would be triggered e.g. by the package manager before installing the packages, if the free space drops before certain threshold etc. The installer calls the Size Dog tool to compute the necessary space needed for installing the selected set of packages and allocate the LVM volumes 'just big enough' for the installation.
This tool will also have it's own config file where an admin/user can define per partition e.g. the desired minimal free space; whether automatic resize is ok or whether low space should just be reported so the admin does it manually using the CLI. The tool automatically checks the config file and state of the Logical volume and performs the required action automatically.</p>

<h3>
<a name="background" class="anchor" href="#background"><span class="octicon octicon-link"></span></a>Background:</h3>

<p>Logical Volume Manager or LVM provides a method of allocating space on mass-storage devices that is more flexible than conventional partitioning schemes. With LVM, a hard drive or set of hard drives is allocated to one or more Physical Volumes.Physical volumes can be placed on other block devices which might span two or more disks.
Currently if the space needed for installation of package is more than the free space in volume then the user has to either delete and clear some space or increase the size of volume manually. With this tool resizing of LVM can be done automatically.
The Idea has been requested by the assigned mentor of the project Dinar Valeev in openFATE:
<a href="https://features.opensuse.org/309704">https://features.opensuse.org/309704</a></p>

<h3>
<a name="use-cases" class="anchor" href="#use-cases"><span class="octicon octicon-link"></span></a>Use Cases:</h3>

<h2>
<a name="case-1" class="anchor" href="#case-1"><span class="octicon octicon-link"></span></a>Case 1:</h2>

<p>a) User wants at least 2 GB to be always free as work space in /usr
b) user runs re-sizer after package installation which then resizes the volume to have at least 2 GB free.</p>

<h2>
<a name="case-2" class="anchor" href="#case-2"><span class="octicon octicon-link"></span></a>Case 2:</h2>

<p>a)  Backup utility demands ~1 GB of free space for backing up of important documents, but the volume   doesn't have that much free space.
b)  Backup utility calls resizer with volume and resize amount as requisites, and the resizer extend the volume to have at least 1 GB of free space.</p>

<h2>
<a name="case-3-system-administrator-can-run-this-tool-to-automatically-increase-or-decrease-the-size-of-volume-allotted-to-each-user-if-some-free-space-is-always-needed-by-a-user-in-hisher-volume" class="anchor" href="#case-3-system-administrator-can-run-this-tool-to-automatically-increase-or-decrease-the-size-of-volume-allotted-to-each-user-if-some-free-space-is-always-needed-by-a-user-in-hisher-volume"><span class="octicon octicon-link"></span></a>Case 3: System Administrator can run this tool to automatically increase or decrease the size of volume allotted to each user if some free space is always needed by a user in his/her volume.</h2>

<h2>
<a name="case-4--to-be-hooked-to-libzypp-once-the-tool-becomes-hard-and-reliable-" class="anchor" href="#case-4--to-be-hooked-to-libzypp-once-the-tool-becomes-hard-and-reliable-"><span class="octicon octicon-link"></span></a>Case 4: ( To be hooked to LibZypp once the tool becomes hard and reliable )</h2>

<p>a)  User installs a package, but that package demands X MB installation space.
b)  Package manager runs resizer which resizes the volumes by the appropriate amount, and then proceed towards installing the software.</p>

<h3>
<a name="benefits" class="anchor" href="#benefits"><span class="octicon octicon-link"></span></a>Benefits:</h3>

<p>a) The user doesn't have to worry about disk space getting low while installation of packages, he/she don't  have to delete files to clear disk space, The tool will take care of that and also the disk space will be used in a better way by allocating the required space requested by the user.</p>

<p>b) The tool will also maintain the free space needed in each volume as defined by the user in config file.</p>

<p>c) The LVM resizing will be more user friendly and hassle free.</p>

<p>d) This tool will not only help openSUSE but can be used by other Package management tools of different Linux distributions.</p>

<h3>
<a name="caveats" class="anchor" href="#caveats"><span class="octicon octicon-link"></span></a>Caveats:</h3>

<p>a) This tool is only implemented for LVM volume groups, so it will not work for non-LVM based file  systems.
b) File systems that are supported are ext3, ext4. xfs and btrfs only.
c) Online shrinking not possible in all cases, file system has to be unmounted before shrinking.</p>

<h3>
<a name="technical-details" class="anchor" href="#technical-details"><span class="octicon octicon-link"></span></a>Technical Details:</h3>

<p>This project idea will be implemented using Python. The tool will use The python bindings of LibLVM and lvm2py API.
python liblvm bindings: <a href="https://github.com/akifkhan/python-lvm">https://github.com/akifkhan/python-lvm</a> 
lvm2py is a ctypes based binding for lvm's liblvmapp api:  <a href="https://github.com/akifkhan/lvm2py">https://github.com/akifkhan/lvm2py</a></p>

<p>Tool will have its own config file stored in /etc the config file will contain details such as:
a) Automatic resizing enabled/disabled (Default: Disabled)
b) System determined resizing/User configured resizing (Default: System configured resizing)
If User configured resizing is enabled, the following options will be available to change:</p>

<p>1) File systems supported: (Default: All LVM fs except /home)</p>

<p>2) File Systems not supported: (Default: None)</p>

<p>3) Free space needed: For each filesystem mentioned, the amount of free space needed, either in MBs / GBs or by % of total volume size. (Default: 5%)</p>

<p>So, it is possible to configure the resizer to keep different amount of free space for various volumes, e.g. 2G for /var and 10% for /usr, independent of each other.</p>

<p>I have created some sample code for the tool here: <a href="https://github.com/akifkhan/SizeDog/blob/master/sample.py">https://github.com/akifkhan/SizeDog/blob/master/sample.py</a></p>

<h3>
<a name="working-of-lvm-resizing" class="anchor" href="#working-of-lvm-resizing"><span class="octicon octicon-link"></span></a>Working of LVM Resizing:</h3>

<p>1) There are logical volumes within Volume Group (/usr, /tmp)
2) Volume Group have free Physical Extents.
3) Logical volume have no free space for package install
4) Install package/packages which requires 12Mb in /tmp, 40Mb in /usr and 16Mb in /var
5) Size Dog will extend logical volumes and file systems /tmp by 3 Logical Extents /var by 10 Logical Extents and var by 4 Logical Extents.</p>

<h3>
<a name="future-goals" class="anchor" href="#future-goals"><span class="octicon octicon-link"></span></a>Future Goals:</h3>

<p>The tool can be useful for all linux distributions that support LVM, so the tool has to be made compatible with most Linux distros and hooking the tool to various package managers. 
Would also work for better integration of this tool in openSUSE operating system. Above all, I would try to keep myself actively associated with the activities in the community. The openSUSE community will gain another developer who will push it to newer heights.</p>

<h2>
<a name="original-project-idea-httpenopensuseorgopensusegsoc_ideasautomatic_resizing_of_lvm_volumes_and_filesystems" class="anchor" href="#original-project-idea-httpenopensuseorgopensusegsoc_ideasautomatic_resizing_of_lvm_volumes_and_filesystems"><span class="octicon octicon-link"></span></a>Original project idea: <a href="http://en.opensuse.org/openSUSE:GSOC_ideas#Automatic_resizing_of_LVM_volumes_and_filesystems">http://en.opensuse.org/openSUSE:GSOC_ideas#Automatic_resizing_of_LVM_volumes_and_filesystems</a>
</h2>

<h3>
<a name="references" class="anchor" href="#references"><span class="octicon octicon-link"></span></a>REFERENCES:</h3>

<p>[1] <a href="http://tldp.org/HOWTO/LVM-HOWTO/">http://tldp.org/HOWTO/LVM-HOWTO/</a>
[2] <a href="http://www.debian-administration.org/articles/410">http://www.debian-administration.org/articles/410</a>
[3] <a href="http://en.wikipedia.org/wiki/Logical_Volume_Manager_(Linux)">http://en.wikipedia.org/wiki/Logical_Volume_Manager_(Linux)</a>
         Name:  Akif Khan Yusufzai   Email : <a href="mailto:akif500@gmail.com">akif500@gmail.com</a>   IRC (Freenode) : akif500
                     <a href="http://www.github.com/akifkhan">www.github.com/akifkhan</a>     <a href="http://www.twitter.com/thisisakif">www.twitter.com/thisisakif</a></p>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/akifkhan/SizeDog/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/akifkhan/SizeDog/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/akifkhan/SizeDog"></a> is maintained by <a href="https://github.com/akifkhan">akifkhan</a>.</p>

          <p>This page was generated by <a href="pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>